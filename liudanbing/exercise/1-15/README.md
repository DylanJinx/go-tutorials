## 项目简介

设计并实现一个基于命令行界面的图书管理系统，允许用户执行一系列操作，如添加、删除、修改、查询和列出书籍。同时，系统应支持数据的持久化存储和加载。此项目将综合应用Go语言的变量、常量、iota、多返回值、init函数、导包、指针、defer、切片、map、struct、面向对象特征（封装、继承、多态）、接口等多个知识点。

## 项目目标

- **巩固Go语言基础知识**：通过实际项目应用变量、常量、iota、多返回值等基础语法。
- **掌握高级特性**：运用指针、defer、切片、map、struct等高级特性处理复杂数据。
- **理解面向对象编程**：通过封装、接口实现多态，模拟继承关系。
- **实践模块化设计**：通过包的导入与管理，组织代码结构，提高代码可维护性。
- **实现数据持久化**：使用文件操作保存和加载数据，确保数据的持久性。

## 功能需求

### 1. 用户界面

- **命令行交互**：通过命令行界面（CLI）与用户交互，提供友好的操作提示和反馈信息。
- **操作选项**：系统应提供以下操作选项供用户选择：
  1. 添加书籍
  2. 删除书籍
  3. 修改书籍信息
  4. 查询书籍
  5. 列出所有书籍
  6. 保存数据
  7. 加载数据
  8. 退出系统

### 2. 数据结构设计

- **Book 结构体**：表示一本书籍，包含以下字段：
  - `ID`（int）：唯一标识符
  - `Title`（string）：书名
  - `Author`（string）：作者
  - `Category`（Category 枚举类型）：书籍类别
  - `Price`（float64）：价格

- **Category 枚举类型**：
  - 使用 `iota` 定义不同的书籍类别，如 Fiction、NonFiction、Science、Biography 等。
  - 实现 `String()` 方法以便于显示类别名称。

- **Library 结构体**：表示图书馆，包含以下字段：
  - `Books`（map[int]Book）：存储书籍的映射，键为书籍ID，值为对应的Book结构体
  - `nextID`（int）：用于生成下一个书籍的唯一ID

### 3. 核心功能实现

#### 3.1 添加书籍

- 用户输入书名、作者、类别编号和价格。
- 系统生成唯一的ID并将新书籍添加到 `Books` 映射中。

#### 3.2 删除书籍

- 用户输入要删除的书籍ID。
- 系统检查ID是否存在，若存在则删除对应的书籍。

#### 3.3 修改书籍信息

- 用户输入要修改的书籍ID。
- 系统查询该ID对应的书籍，若存在则允许用户修改书名、作者、类别和价格。
- 用户可选择跳过某些字段的修改。

#### 3.4 查询书籍

- 用户输入要查询的书籍ID。
- 系统显示对应书籍的详细信息。

#### 3.5 列出所有书籍

- 系统列出所有存储的书籍信息。

#### 3.6 保存数据

- 用户输入要保存的文件名（如 `books.json`）。
- 系统将当前所有书籍数据保存到指定的JSON文件中。

#### 3.7 加载数据

- 用户输入要加载的文件名（如 `books.json`）。
- 系统从指定文件中加载书籍数据，覆盖当前内存中的数据。

#### 3.8 退出系统

- 结束程序运行。

### 4. 数据持久化

- **保存数据**：
  - 使用 `encoding/json` 包将 `Books` 映射序列化为JSON格式，并保存到指定文件。
  - 使用 `defer` 确保文件在保存完成后被正确关闭。

- **加载数据**：
  - 从指定文件中读取JSON数据，反序列化为 `Books` 映射。
  - 更新 `nextID` 以确保ID的唯一性。

### 5. 并发安全

- 使用 `sync.Mutex` 保护对 `Books` 映射和 `nextID` 的并发访问，确保数据的一致性。

### 6. 接口与多态

- **Printable 接口**：
  - 定义一个 `PrintDetails()` 方法，用于打印书籍的详细信息。
  - `Book` 结构体实现 `Printable` 接口，实现多态行为。

### 7. 错误处理

- 适当处理用户输入错误，如无效的ID、类别编号、价格等。
- 提供友好的错误提示信息，指导用户正确操作。

## 非功能需求

### 1. 可维护性

- **模块化设计**：将不同功能划分到不同的包中，如 `models`、`library`、`file` 等，便于维护和扩展。
- **代码注释**：为重要的代码段和函数添加注释，增强代码可读性。

### 2. 可扩展性

- **类别扩展**：允许在不修改核心代码的情况下，轻松添加新的书籍类别。
- **功能扩展**：设计时考虑未来可能的功能扩展，如按类别筛选、按价格排序、批量导入导出等。

### 3. 用户体验

- **友好的提示信息**：清晰明确的操作提示，减少用户操作错误。
- **输入验证**：有效的用户输入验证，确保数据的正确性和完整性。

## 技术要求

### 2. 项目结构

建议采用以下项目目录结构，以实现模块化设计：

```
library-management/
├── go.mod
├── main.go
├── models/
│   └── models.go
├── library/
│   └── library.go
├── file/
│   └── file.go
└── utils/
    └── utils.go
```

### 3. 使用的Go语言特性

- **变量与常量**：多种方式声明变量，使用常量和 `iota` 定义枚举类型。
- **多返回值**：在函数中返回多个值，如查询函数返回书籍和布尔值。
- **init函数与导包**：使用 `init` 函数进行初始化，熟悉不同的导包方式。
- **指针**：在方法接收者中使用指针，提高效率并允许修改结构体内容。
- **defer**：在文件操作中使用 `defer` 确保资源被正确释放。
- **切片和map**：使用 `map` 存储书籍数据，使用切片列出书籍。
- **struct**：定义和使用结构体表示复杂数据。
- **面向对象特征**：通过封装和接口实现模块化设计，利用接口实现多态。
- **接口**：定义和实现接口，实现不同类型的多态行为。

## 项目步骤

### 1. 项目初始化

- **创建项目文件夹**：

  ```bash
  mkdir library-management
  cd library-management
  ```

- **初始化Go模块**：

  ```bash
  go mod init library-management
  ```

### 2. 定义数据结构

- **创建 `models` 包**：

  - 在 `models/` 文件夹中创建 `models.go` 文件。
  - 定义 `Book` 结构体、`Category` 枚举类型和 `Printable` 接口。

### 3. 实现核心功能

- **创建 `library` 包**：

  - 在 `library/` 文件夹中创建 `library.go` 文件。
  - 实现添加、删除、更新、查询和列出书籍的方法。
  - 使用 `sync.Mutex` 确保并发安全。

### 4. 实现数据持久化

- **创建 `file` 包**：

  - 在 `file/` 文件夹中创建 `file.go` 文件。
  - 实现保存和加载书籍数据的方法，使用JSON格式进行序列化和反序列化。
  - 使用 `defer` 确保文件在操作完成后被正确关闭。

### 5. 实现用户界面

- **编写 `main.go`**：

  - 在项目根目录下创建 `main.go` 文件。
  - 使用 `bufio` 和 `fmt` 包实现命令行交互逻辑。
  - 调用 `library` 和 `file` 包提供的功能实现用户操作。
